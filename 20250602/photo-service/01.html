<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì‚¬ì§„ ì¸í™” ì‹œë®¬ë ˆì´ì…˜</title>
  <style>
    #preview {
      display: none;
      width: 150px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“¸ ì‚¬ì§„ ì¸í™” ì„œë¹„ìŠ¤ setTimeout</h2>
  <p>ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”:</p>
  <input type="file" id="file-input" accept="image/*" />
  <br><br>
  <img id="preview">
  <br>
  <button id="order-btn">ğŸ“¦ ì£¼ë¬¸í•˜ê¸°</button>
  <br>
  <ul id="log"></ul>

  <script>
    // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ
    // 2. ì•¡ì ì„ íƒ
    // 3. ë°°ì†¡ ìš”ì²­

    const fileInput = document.getElementById('file-input');
    const orderBtn = document.getElementById('order-btn');
    const log = document.getElementById('log');
    const preview = document.getElementById('preview');

    let selectedFile = null; // ì²¨ë¶€í•œ í˜„ì¬ íŒŒì¼

    fileInput.addEventListener('change', () => {
      log.innerHTML = '';

      console.log(fileInput.files)
      const file = fileInput.files[0];

      selectedFile = file;

      const reader = new FileReader();
      reader.addEventListener('load', e => {
        preview.src = e.target.result;
        preview.style.display = 'block';
      });
      reader.readAsDataURL(file);
    });

    orderBtn.addEventListener('click', async () => {
      if (!selectedFile) {
        addLog('ì¸ì‡„í•  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }

      addLog('ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ì‹œì‘');
      
      try {
        const photoId = await uploadPhoto(selectedFile);
        const orderId = await chooseFrame(photoId);
        const message = await requestDelivery(orderId);
        addLog(message);
      } catch (error) {
        addLog(error);
      } finally {
        addLog('fin. ì´ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.');
      }
    });

    // 1. ì‚¬ì§„ ì—…ë¡œë“œ
    function uploadPhoto(file) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          // íŒŒì¼ëª…ì´ ì§§ìœ¼ë©´ ì—ëŸ¬ ë°œìƒ
          if (file.name.length < 6) {
            reject('íŒŒì¼ ì´ë¦„ì´ ë„ˆë¬´ ì§§ì•„ìš”.');
            return;
          }

          addLog(`${file.name} ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ`);
          const photoId = `PHOTO_${Date.now()}`;
          resolve(photoId);
        }, 1000);
      });
    }

    // 2. ì•¡ì ì„ íƒ
    function chooseFrame(photoId) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          addLog(`${photoId} ì‚¬ì§„ìš© ì•¡ì ì„ íƒ ì™„ë£Œ`);
          const orderId = `ORDER_${Math.floor(Math.random()*100000)}`;
          resolve(orderId);
        }, 1500);
      });
    }

    // 3. ë°°ì†¡ ìš”ì²­
    function requestDelivery(orderId) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          const message = `${orderId} ì£¼ë¬¸, ë°°ì†¡ ìš”ì²­ ì™„ë£Œ`;
          resolve(message);
        }, 1000);
      });
    }

    function addLog(text) {
      const li = document.createElement('li');
      li.textContent = text;
      log.append(li);
    }
  </script>
</body>
</html>
